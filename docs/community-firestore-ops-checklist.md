# Community Firestore Ops Checklist

커뮤니티(게시판) 릴리스 전/후에 Firestore 규칙과 인덱스를 점검하기 위한 운영 체크리스트입니다.

## 1) 배포 전 점검

1. `firestore.rules` 변경사항 확인
- `bulletin` create/update 제약이 최신 스키마(`tags`, `likeCount`, `reportCount`, `commentCount`, `clientId`)와 일치하는지 확인
- 기존 문서 호환 로직(누락 카운트 필드 허용) 유지 확인

2. 로컬 규칙 시뮬레이션
- Emulator 사용 시, 게시글 생성/좋아요/신고 시나리오가 규칙에 의해 허용되는지 확인
- 금지 시나리오(임의 필드 수정, 삭제, 과도한 업데이트) 차단 확인

3. 인덱스 요구사항 확인
- 현재 구현은 클라이언트 정렬(최신/좋아요/댓글수)을 사용해 **추가 복합 인덱스가 필수는 아님**
- 추후 서버 정렬 쿼리(예: `orderBy('likeCount')`) 도입 시 `firestore.indexes.json` 생성/배포 필요

## 2) 수동 테스트 시나리오

1. 게시글 작성
- 태그 4종과 함께 정상 저장되는지
- 연속 작성 제한(쿨다운/윈도우 제한)이 동작하는지

2. 목록 정렬
- 최신/인기(좋아요)/댓글수 전환 시 즉시 정렬 반영되는지

3. 좋아요
- 동일 클라이언트 중복 좋아요 방지 동작 확인
- 오프라인(localStorage 폴백)에서도 동일 동작 확인

4. 신고
- 신고 모달에서 사유 선택 후 피드백 표시 확인
- 온라인 시 `bulletinReports` 생성 및 `reportCount` 증가 확인
- 오프라인 폴백 시 UI/카운트 반영 확인

5. 기존 데이터 호환
- 구 스키마 문서(카운트/태그 없는 글)도 목록 렌더와 액션이 깨지지 않는지 확인

## 3) 운영 모니터링

1. 기본 모니터링 지표
- 게시글 생성량(일/주)
- 신고율(`reportCount > 0` 비율)
- 태그 분포(메뉴/지역/가격대/난이도)

2. 이상 징후
- 특정 `clientId`의 짧은 시간 다량 생성
- 특정 게시글 `reportCount` 급증

## 4) 롤백/완화 가이드

1. 규칙 충돌 시
- 직전 배포된 `firestore.rules`로 롤백
- 임시로 게시글 write 제한을 강화(필드/길이 제약)

2. 스팸 급증 시
- 클라이언트 제한 상향(쿨다운/윈도우)
- 관리자 TODO 문서(`docs/community-admin-todo.md`) 기준으로 차단 리스트 기능 우선 도입

## 5) 다음 단계 TODO

- `firestore.indexes.json` 정식 도입(서버 정렬 쿼리로 전환 시)
- `communitySettings/blockedClients` 기반 서버 측 차단 룰
- 관리자 전용 대시보드(신고 큐/숨김 처리/운영 메모)
